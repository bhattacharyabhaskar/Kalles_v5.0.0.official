<script>
document.addEventListener("DOMContentLoaded", function () {
  const atcForm = document.querySelector('form[action="/cart/add"]');
  if (!atcForm) {
    console.warn("ðŸ§© No ATC form found");
    return;
  }

  const atcButton = atcForm.querySelector('button[type="submit"]');
  const debugPrefix = "ðŸ§© ADDON:";

  function removeOldAddonInputs() {
    atcForm.querySelectorAll(".addon-dynamic").forEach(el => el.remove());
  }

  function injectAddonInputs() {
    removeOldAddonInputs();
    const selected = document.querySelectorAll(".addon-checkbox:checked");

    console.log(`ðŸ“¦ Add-ons selected: ${selected.length}`);
    

    selected.forEach((checkbox) => {
      const variantId = checkbox.dataset.variantId;
      if (!variantId) return;
      console.log(`${debugPrefix} Injecting addon variant ${variantId}`);

      const idInput = document.createElement("input");
      idInput.type = "hidden";
      idInput.name = "items[][id]";
      idInput.value = variantId;
      idInput.classList.add("addon-dynamic");

      const qtyInput = document.createElement("input");
      qtyInput.type = "hidden";
      qtyInput.name = "items[][quantity]";
      qtyInput.value = "1";
      qtyInput.classList.add("addon-dynamic");

      atcForm.appendChild(idInput);
      atcForm.appendChild(qtyInput);
    });
  }
  // Inject just before submit
  atcForm.addEventListener("submit", function () {
    injectAddonInputs();
  });

  // Also hook on button click to ensure injection happens in case theme JS takes over
  atcButton?.addEventListener("click", function () {
    injectAddonInputs();
  });
});
</script>
